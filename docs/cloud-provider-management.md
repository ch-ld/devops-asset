# äº‘è´¦å·ç®¡ç†æ¨¡å—æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

äº‘è´¦å·ç®¡ç†æ¨¡å—æ˜¯DevOpsèµ„äº§ç®¡ç†ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œè´Ÿè´£ç®¡ç†å¤šäº‘ç¯å¢ƒä¸‹çš„äº‘è´¦å·å‡­è¯ã€èµ„æºåŒæ­¥å’Œç›‘æ§ã€‚æœ¬æ¨¡å—æ”¯æŒé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€AWSç­‰ä¸»æµäº‘å‚å•†ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åç«¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Controller    â”‚    â”‚    Service      â”‚    â”‚   Repository    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ ProviderHandler â”‚â”€â”€â”€â–¶â”‚ ProviderService â”‚â”€â”€â”€â–¶â”‚ ProviderRepo    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   HTTP Routes   â”‚    â”‚   Cloud Adapter â”‚    â”‚   MySQL DB      â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ /api/v1/cmdb/   â”‚    â”‚ - AliyunAdapter â”‚    â”‚ cmdb_providers  â”‚
â”‚ providers/*     â”‚    â”‚ - TencentAdapterâ”‚    â”‚                 â”‚
â”‚                 â”‚    â”‚ - AWSAdapter    â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‰ç«¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Views         â”‚    â”‚   Components    â”‚    â”‚   API Services  â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ provider/       â”‚â”€â”€â”€â–¶â”‚ ProviderModal   â”‚â”€â”€â”€â–¶â”‚ host.ts         â”‚
â”‚ index.vue       â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Router        â”‚    â”‚   State Mgmt    â”‚    â”‚   HTTP Client   â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ Dynamic Routes  â”‚    â”‚ Reactive Data   â”‚    â”‚ Axios Requests  â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### 1. äº‘è´¦å·ç®¡ç†

**åŠŸèƒ½ç‰¹æ€§**ï¼š
- æ”¯æŒå¤šäº‘å‚å•†ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€AWSï¼‰
- å‡­è¯å®‰å…¨å­˜å‚¨å’ŒåŠ å¯†
- å®æ—¶å‡­è¯éªŒè¯
- åŒºåŸŸè‡ªåŠ¨è·å–

**APIæ¥å£**ï¼š
```http
GET    /api/v1/cmdb/providers          # è·å–äº‘è´¦å·åˆ—è¡¨
POST   /api/v1/cmdb/providers          # åˆ›å»ºäº‘è´¦å·
PUT    /api/v1/cmdb/providers/:id      # æ›´æ–°äº‘è´¦å·
DELETE /api/v1/cmdb/providers/:id      # åˆ é™¤äº‘è´¦å·
POST   /api/v1/cmdb/providers/validate # éªŒè¯å‡­è¯
```

### 2. èµ„æºåŒæ­¥

**åŠŸèƒ½ç‰¹æ€§**ï¼š
- è‡ªåŠ¨å‘ç°äº‘èµ„æº
- å¢é‡åŒæ­¥æœºåˆ¶
- åŒæ­¥çŠ¶æ€ç›‘æ§
- é”™è¯¯å¤„ç†å’Œé‡è¯•

**APIæ¥å£**ï¼š
```http
POST /api/v1/cmdb/providers/:id/sync   # è§¦å‘èµ„æºåŒæ­¥
```

### 3. å‡­è¯ç®¡ç†

**å®‰å…¨ç‰¹æ€§**ï¼š
- AESåŠ å¯†å­˜å‚¨
- è®¿é—®æƒé™æ§åˆ¶
- æ“ä½œå®¡è®¡æ—¥å¿—
- å¯†é’¥è½®æ¢æ”¯æŒ

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### åç«¯å®ç°

#### 1. æ•°æ®æ¨¡å‹

```go
type Provider struct {
    gorm.Model
    Name        string `json:"name" gorm:"size:100;not null"`
    Type        string `json:"type" gorm:"size:20;not null"`
    AccessKey   string `json:"access_key" gorm:"size:255;not null"`
    SecretKey   string `json:"secret_key" gorm:"size:255;not null"`
    Region      string `json:"region" gorm:"size:50"`
    Description string `json:"description" gorm:"size:500"`
    Status      string `json:"status" gorm:"size:20;default:active"`
}
```

#### 2. äº‘é€‚é…å™¨æ¥å£

```go
type CloudAdapter interface {
    ListInstances() ([]cmdb.Host, error)
    GetInstanceStatus(instanceID string) (string, error)
    GetInstanceInfo(instanceID string) (*cmdb.Host, error)
}
```

#### 3. åŠ å¯†æœåŠ¡

```go
func (s *ProviderService) encryptSecret(secret string) (string, error) {
    key := []byte(config.GetAESKey())
    return encryption.Encrypt(secret, key)
}

func (s *ProviderService) decryptSecret(encryptedSecret string) (string, error) {
    key := []byte(config.GetAESKey())
    return encryption.Decrypt(encryptedSecret, key)
}
```

### å‰ç«¯å®ç°

#### 1. ç»„ä»¶ç»“æ„

```vue
<template>
  <div class="provider-management">
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-cards">
      <StatCard v-for="stat in stats" :key="stat.type" :data="stat" />
    </div>
    
    <!-- æœç´¢ç­›é€‰ -->
    <div class="search-section">
      <SearchForm @search="handleSearch" @reset="handleReset" />
    </div>
    
    <!-- äº‘è´¦å·åˆ—è¡¨ -->
    <div class="provider-list">
      <ProviderCard 
        v-for="provider in providerList" 
        :key="provider.id"
        :provider="provider"
        @edit="handleEdit"
        @delete="handleDelete"
        @sync="handleSync"
      />
    </div>
    
    <!-- æ·»åŠ /ç¼–è¾‘æ¨¡æ€æ¡† -->
    <ProviderModal 
      ref="providerModalRef"
      @success="handleModalSuccess"
    />
  </div>
</template>
```

#### 2. çŠ¶æ€ç®¡ç†

```typescript
// å“åº”å¼æ•°æ®
const loading = ref(false)
const providerList = ref([])
const searchForm = reactive({
  name: '',
  provider_type: undefined,
})

// æ–¹æ³•
async function fetchProviderList() {
  loading.value = true
  try {
    const response = await getProviderList(searchForm)
    providerList.value = response.data || []
  } catch (error) {
    ElMessage.error('è·å–äº‘è´¦å·åˆ—è¡¨å¤±è´¥')
  } finally {
    loading.value = false
  }
}
```

## ğŸ” é—®é¢˜æ’æŸ¥

### å¸¸è§é—®é¢˜

1. **è·¯ç”±æ— æ³•åŠ è½½**
   - æ£€æŸ¥æ•°æ®åº“ä¸­èœå•çš„componentå­—æ®µæ ¼å¼
   - ç¡®è®¤å‰ç«¯ç»„ä»¶æ–‡ä»¶è·¯å¾„æ­£ç¡®
   - éªŒè¯åŠ¨æ€è·¯ç”±æ³¨å†Œé€»è¾‘

2. **å‡­è¯éªŒè¯å¤±è´¥**
   - æ£€æŸ¥äº‘å‚å•†å‡­è¯æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
   - éªŒè¯APIæƒé™é…ç½®

3. **èµ„æºåŒæ­¥å¼‚å¸¸**
   - æŸ¥çœ‹åç«¯æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
   - æ£€æŸ¥äº‘å‚å•†APIé™åˆ¶
   - ç¡®è®¤èµ„æºè®¿é—®æƒé™

### è°ƒè¯•æ–¹æ³•

1. **åç«¯è°ƒè¯•**
```bash
# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs -f server

# æ£€æŸ¥æ•°æ®åº“æ•°æ®
docker exec -it devops-asset-mysql mysql -u root -p
```

2. **å‰ç«¯è°ƒè¯•**
```bash
# å¼€å¯å¼€å‘è€…å·¥å…·
# æŸ¥çœ‹Networké¢æ¿çš„APIè¯·æ±‚
# æ£€æŸ¥Consoleé¢æ¿çš„é”™è¯¯ä¿¡æ¯
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### åç«¯ä¼˜åŒ–

1. **æ•°æ®åº“ä¼˜åŒ–**
   - æ·»åŠ é€‚å½“çš„ç´¢å¼•
   - ä½¿ç”¨è¿æ¥æ± 
   - å®ç°æŸ¥è¯¢ç¼“å­˜

2. **APIä¼˜åŒ–**
   - å®ç°åˆ†é¡µæŸ¥è¯¢
   - æ·»åŠ å“åº”å‹ç¼©
   - ä½¿ç”¨Redisç¼“å­˜

### å‰ç«¯ä¼˜åŒ–

1. **ç»„ä»¶ä¼˜åŒ–**
   - å®ç°è™šæ‹Ÿæ»šåŠ¨
   - ä½¿ç”¨ç»„ä»¶æ‡’åŠ è½½
   - ä¼˜åŒ–é‡æ¸²æŸ“é€»è¾‘

2. **ç½‘ç»œä¼˜åŒ–**
   - å®ç°è¯·æ±‚å»é‡
   - æ·»åŠ åŠ è½½çŠ¶æ€
   - ä½¿ç”¨é˜²æŠ–èŠ‚æµ

## ğŸ”’ å®‰å…¨è€ƒè™‘

### æ•°æ®å®‰å…¨

1. **å‡­è¯åŠ å¯†**ï¼šä½¿ç”¨AES-256åŠ å¯†å­˜å‚¨äº‘è´¦å·å‡­è¯
2. **ä¼ è¾“å®‰å…¨**ï¼šHTTPSä¼ è¾“ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»
3. **è®¿é—®æ§åˆ¶**ï¼šåŸºäºRBACçš„æƒé™æ§åˆ¶

### æ“ä½œå®‰å…¨

1. **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ‰€æœ‰æ•æ„Ÿæ“ä½œ
2. **æƒé™éªŒè¯**ï¼šæ¯ä¸ªAPIéƒ½è¿›è¡Œæƒé™æ£€æŸ¥
3. **è¾“å…¥éªŒè¯**ï¼šä¸¥æ ¼çš„å‚æ•°æ ¡éªŒå’Œè¿‡æ»¤

## ğŸš€ æœªæ¥è§„åˆ’

### çŸ­æœŸç›®æ ‡

- [ ] æ”¯æŒæ›´å¤šäº‘å‚å•†
- [ ] å®ç°æˆæœ¬ç›‘æ§
- [ ] æ·»åŠ èµ„æºæ ‡ç­¾ç®¡ç†
- [ ] ä¼˜åŒ–åŒæ­¥æ€§èƒ½

### é•¿æœŸç›®æ ‡

- [ ] å®ç°å¤šç§Ÿæˆ·éš”ç¦»
- [ ] æ·»åŠ è‡ªåŠ¨åŒ–è¿ç»´
- [ ] é›†æˆç›‘æ§å‘Šè­¦
- [ ] æ”¯æŒæ··åˆäº‘ç®¡ç†
