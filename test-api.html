<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIæµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; white-space: pre-wrap; }
        button { padding: 8px 16px; margin: 5px; }
    </style>
</head>
<body>
    <h1>APIæµ‹è¯•é¡µé¢</h1>
    
    <div class="section">
        <h2>1. æµ‹è¯•ä¸»æœºç»„API</h2>
        <button onclick="testHostGroupAPI()">æµ‹è¯•ä¸»æœºç»„API</button>
        <div id="hostGroupResult" class="result"></div>
    </div>

    <div class="section">
        <h2>2. æµ‹è¯•MessageBox</h2>
        <button onclick="testMessageBox()">æµ‹è¯•åˆ é™¤ç¡®è®¤æ¡†</button>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api/v1/cmdb';
        
        async function testHostGroupAPI() {
            try {
                console.log('ğŸš€ å¼€å§‹æµ‹è¯•ä¸»æœºç»„API...');
                const response = await fetch(`${API_BASE}/host_groups/tree`);
                const data = await response.json();
                
                console.log('ğŸ“¡ APIå“åº”:', data);
                
                document.getElementById('hostGroupResult').textContent = 
                    'åŸå§‹å“åº”:\n' + JSON.stringify(data, null, 2);
                
                // æµ‹è¯•æ•°æ®å¤„ç†
                if (data.code === 200) {
                    const groupData = data.data || [];
                    console.log('ğŸ“Š ä¸»æœºç»„æ•°æ®:', groupData);
                    
                    // æ„å»ºæ ‘å½¢ç»“æ„
                    const buildTree = (items) => {
                        const tree = [];
                        const map = {};
                        
                        // åˆ›å»ºæ˜ å°„
                        items.forEach(item => {
                            map[item.id] = { ...item, children: [] };
                        });
                        
                        // æ„å»ºæ ‘å½¢ç»“æ„
                        items.forEach(item => {
                            if (item.parent_id === null || item.parent_id === undefined) {
                                tree.push(map[item.id]);
                            } else {
                                if (map[item.parent_id]) {
                                    map[item.parent_id].children.push(map[item.id]);
                                }
                            }
                        });
                        
                        return tree;
                    };
                    
                    const treeData = buildTree(groupData);
                    console.log('ğŸŒ³ æ ‘å½¢ç»“æ„:', treeData);
                    
                    document.getElementById('hostGroupResult').textContent += 
                        '\n\næ ‘å½¢ç»“æ„:\n' + JSON.stringify(treeData, null, 2);
                }
                
            } catch (error) {
                console.error('âŒ APIæµ‹è¯•å¤±è´¥:', error);
                document.getElementById('hostGroupResult').textContent = 'é”™è¯¯: ' + error.message;
            }
        }
        
        function testMessageBox() {
            // æ¨¡æ‹ŸElement Plus MessageBox
            const message = `ç¡®å®šè¦åˆ é™¤ä¸»æœºç»„"æµ‹è¯•ç»„"å—ï¼Ÿ

æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤è¯¥ä¸»æœºç»„ï¼Œä¸”ä¸å¯æ¢å¤ã€‚
è¯·ç¡®è®¤æ‚¨çœŸçš„è¦æ‰§è¡Œæ­¤æ“ä½œã€‚`;
            
            if (confirm(message)) {
                alert('ç”¨æˆ·ç¡®è®¤åˆ é™¤');
            } else {
                alert('ç”¨æˆ·å–æ¶ˆåˆ é™¤');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = function() {
            testHostGroupAPI();
        };
    </script>
</body>
</html>
